function setCookie(e,t){var n=new Date;n.setTime(n.getTime()+2592e6),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()}function getCookie(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):null}function delCookie(e){var t=new Date;t.setTime(t.getTime()-1);var n=getCookie(e);null!=n&&(document.cookie=e+"="+n+";expires="+t.toGMTString())}function counts(e){0==waits?(e.removeAttribute("disabled"),e.value="获取验证码",waits=60):(e.setAttribute("disabled",!0),e.value=waits+" s",waits--,setTimeout(function(){counts(e)},1e3))}function upload_img(){var e=getUrlRoute(),t=new FormData(document.getElementById("mile_0"));$.ajax({type:"post",url:e+"/fsms/api/web/index.php/v1/file/upload",dataType:"json",data:t,contentType:!1,processData:!1,success:function(t){200==t.status&&($("input[name=file_id]").val(t.data.file_id),$(".img-user").attr("src",e+"/fsms/api/web/index.php/v1/file/download?file="+t.data.file_id))},error:function(e){}})}function backSmall(){$(".touchBack").addClass("smallImg")}function removeSmallimg(){$(".touchBack").removeClass("smallImg")}function getUrlRoute(){return"http://soft.glaveinfo.com"}function getCode(e,t){var n=getUrlRoute(),o=/^1(3|4|5|7|8)\d{9}$/,i=$("input[name=phone]").val();if(!o.test(i))return $.fadeModel("手机号码有误，请重填"),!1;$.ajax({url:n+"/fsms/api/web/index.php/v1/site/get-sms-code",type:"post",dataType:"json",data:{phone:i,type:t},success:function(t){200==t.status?($.fadeModel("验证码已发送，注意查收"),counts(e)):$.fadeModel(t.message)}})}function getRequest(e){var t=decodeURIComponent(location.href),n=t.substring(t.indexOf("?")+1,t.length).split("&"),o={};for(i=0;j=n[i];i++)o[j.substring(0,j.indexOf("=")).toLowerCase()]=j.split("=")[1];var a=o[e.toLowerCase()];return void 0===a?"":a}function getOut(e){$.post(e+"/fsms/api/web/index.php/v1/site/logout",{token:token},function(e){200!=e.status&&300!=e.status||(delCookie("token"),window.location.href="login.html")},"json")}$(function(){var e=getUrlRoute(),t=getCookie("token"),n=/^1(3|4|5|7|8)\d{9}$/;$(".signup_btn").click(function(){getCode(this,1)}),$(".find_code").click(function(){getCode(this,2)}),$(".register_btn").click(function(){var t=$(".regist-panel input[name=phone]").val(),o=$(".regist-panel input[name=code]").val(),i=$(".regist-panel input[name=password]").val(),a=$(".regist-panel input[name=repassword]").val();try{if(!n.test(t))throw new Error("手机号码不正确");if(!o.length)throw new Error("验证码不能为空");if(!(6<=i.length<=12))throw new Error("密码必须为6-12位");if(i!=a)throw new Error("两次密码不一致")}catch(e){return $.fadeModel(e.message),!1}$.ajax({url:e+"/fsms/api/web/index.php/v1/site/register",type:"post",dataType:"json",data:{phone:t,password:i,code:o},success:function(e){200==e.status?($.fadeModel("注册成功"),setTimeout(function(){window.location.replace("login.html","register.html")},500)):$.fadeModel(e.message)}})}),$(".login_btn").click(function(){var t=$(".login-panel .login-phone").val(),o=$(".login-panel .login-psw").val();try{if(!t.length)throw new Error("手机号不能为空");if(!n.test(t))throw new Error("手机号码有误");if(!o.length)throw new Error("密码不能为空")}catch(e){return $.fadeModel(e.message),!1}$.ajax({url:e+"/fsms/api/web/index.php/v1/site/login",type:"post",dataType:"json",data:{phone:t,password:o},success:function(e){if(200==e.status){$.fadeModel("登录成功"),setCookie("token",e.data.token);var t=document.referrer,n=t.substr(t.lastIndexOf("/")+1);setTimeout(function(){return n.indexOf("register")>=0||n.indexOf("login")>=0||!n?(window.location.href="index.html",!1):n.indexOf("edit-pwd")>=0?(window.location.href="mine.html",!1):n.indexOf("find-pwd")>=0?(window.location.href="mine.html",!1):void(window.location.href=t)},500)}else $.fadeModel(e.message)}})}),$(".find_btn").click(function(){var t=$(".find-panel input[name=phone]").val(),o=$(".find-panel input[name=code]").val(),i=$(".find-panel input[name=password]").val(),a=$(".find-panel input[name=repassword]").val();try{if(!o.length)throw new Error("验证码不能为空");if(!n.test(t))throw new Error("手机号码有误");if(!i.length)throw new Error("密码不能为空");if(i!=a)throw new Error("两次密码不一致")}catch(e){return $.fadeModel(e.message),!1}$.ajax({url:e+"/fsms/api/web/index.php/v1/site/reset-password",type:"post",dataType:"json",data:{phone:t,password:i,code:o},success:function(e){200==e.status?($.fadeModel("密码重置成功"),setTimeout(function(){return window.location.replace("login.html","find-pwd.html"),!1},500)):$.fadeModel(e.message)}})}),$(".signout_btn").click(function(){$.post(e+"/fsms/api/web/index.php/v1/site/logout",{token:t},function(e){200==e.status&&(setTimeout(function(){window.location.replace("mine.html","mine-setting.html")},500),delCookie("token"))},"json")}),$(".edit_btn").click(function(){var n=$(".edit-panel .old-pwd").val(),o=$(".edit-panel .new-pwd").val(),i=$(".edit-panel .new-repwd").val();try{if(!n.length)throw new Error("旧密码不能为空");if(!o.length)throw new Error("新密码不能为空");if(o==n)throw new Error("新密码不可与旧密码一致");if(o!=i)throw new Error("两次密码不一致")}catch(e){return $.fadeModel(e.message),!1}$.ajax({url:e+"/fsms/api/web/index.php/v1/user/update-password",type:"post",dataType:"json",data:{token:t,old_pwd:n,new_pwd:o},success:function(e){200==e.status&&($.fadeModel("修改密码成功，请重新登录"),delCookie("token"),setTimeout(function(){window.location.replace("login.html","edit-pwd.html")},500))}})}),$(".user_btn").click(function(){var n=$("input[name='file_id']").val(),o=$(".user-info input[name=nickname]").val(),i=$(".user-info input[name=sex]:checked").val();$.ajax({url:e+"/fsms/api/web/index.php/v1/user/update-user-info",type:"post",dataType:"json",data:{token:t,pic:n,nickname:o,sex_id:i},success:function(e){200==e.status?($.fadeModel("修改信息成功"),setTimeout(function(){window.location.replace("mine.html","mine-userInfo.html")},500)):$.fadeModel(e.message)}})})});var waits=60,token=getCookie("token");